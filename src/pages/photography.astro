---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import Carousel from '../components/Carousel.astro';
import { v2 as cloudinary } from 'cloudinary';
import '../styles/global.css';
const pageTitle = "Photography";

cloudinary.config({
    cloud_name: import.meta.env.PUBLIC_CLOUDINARY_CLOUD_NAME,
    api_key: import.meta.env.CLOUDINARY_API_KEY || process.env.CLOUDINARY_API_KEY,
    api_secret: import.meta.env.CLOUDINARY_API_SECRET || process.env.CLOUDINARY_API_SECRET,
});

async function getImagesFromFolder(folderName: string) {
  try {
    const results = await cloudinary.search
      .expression(`folder:${folderName}/*`) // Look inside this folder
      .sort_by('public_id', 'desc')         // Sort by name (or 'created_at')
      .max_results(30)                      // Limit to 30 images
      .execute();

    // Map the results to just the URL or Public ID
    return results.resources.map((file: any) => file.secure_url);
  } catch (error) {
    console.error(`Error fetching ${folderName}:`, error);
    return [];
  }
}

const banffPhotos = await getImagesFromFolder('website/banff');
const rockiesPhotos = await getImagesFromFolder('website/rockies');

---
<BaseLayout pageTitle={pageTitle}>

    <h2 class="carousel-title">Banff</h2>
    <Carousel images={banffPhotos} id="banff" />
    <div class="carousel-spacer"></div>
    <h2 class="carousel-title">Rocky Mountain National Park</h2>
    <Carousel images={rockiesPhotos} id="rockies" />
    <div class="bottom-spacer"></div>
</BaseLayout>


<style>
  .carousel-title {
    display: flex;
    width: 100%;
    max-width: 80ch;   
    margin: 0 auto;   
    padding: 1rem;
    justify-content: center;
    color: var(--text-main);
  }
  .carousel-spacer {
    height: 5rem; /* Adjust this number to increase/decrease space */
  } 
  .bottom-spacer {
    height: 10rem; /* Adjust this number to increase/decrease space */
  }
</style>
